# دليل النشر والتشغيل - منصة Livreure

## نظرة عامة

يوضح هذا الدليل كيفية نشر منصة Livreure على Render، مع التركيز على نشر الواجهة الخلفية (Flask) كـ Web Service وخدمتها للواجهة الأمامية (HTML, CSS, JavaScript).

## 1. إعداد المشروع للنشر

تأكد من أن مشروعك جاهز للنشر. لقد قمت بالفعل بتعديل ملف `backend/src/main.py` لخدمة ملفات الواجهة الأمامية الثابتة. هذا يعني أن الواجهة الخلفية ستكون مسؤولة عن تقديم كل من API وملفات الواجهة الأمامية.

### 1.1. تحديث مسارات API في الواجهة الأمامية

عند نشر الواجهة الخلفية كـ `Web Service` على Render، ستحصل على عنوان URL خاص بها. يجب عليك تحديث `API_BASE_URL` في ملفات `script.js` و `admin-dashboard/admin-script.js` ليشير إلى هذا العنوان. على سبيل المثال، إذا كان عنوان URL الخاص بالواجهة الخلفية هو `https://your-backend-service.onrender.com`، فيجب أن يكون `API_BASE_URL` كالتالي:

```javascript
const API_BASE_URL = 'https://your-backend-service.onrender.com/api';
```

**ملاحظة:** ستحتاج إلى تحديث هذا بعد نشر الواجهة الخلفية والحصول على عنوان URL الخاص بها.

## 2. نشر الواجهة الخلفية كـ Web Service على Render

اتبع الخطوات التالية لنشر الواجهة الخلفية كـ `Web Service` على Render:

1.  **سجل الدخول إلى Render:** اذهب إلى [https://render.com/](https://render.com/) وسجل الدخول إلى حسابك.
2.  **إنشاء خدمة ويب جديدة:** في لوحة التحكم الخاصة بك، انقر على `New` ثم اختر `Web Service`.
3.  **ربط مستودع GitHub:** اختر مستودع GitHub الخاص بك الذي يحتوي على مشروع Livreure (`anonsec02/livreure-web-app`). تأكد من أن Render لديه الأذونات اللازمة للوصول إلى المستودع.
4.  **تكوين الخدمة:**
    *   **Name (الاسم):** اختر اسمًا لخدمة الويب الخاصة بك (مثال: `livreure-backend`).
    *   **Region (المنطقة):** اختر أقرب منطقة جغرافية لمستخدميك.
    *   **Branch (الفرع):** `master` (أو الفرع الذي يحتوي على الكود الخاص بك).
    *   **Root Directory (المجلد الرئيسي):** `backend` (هذا هو المجلد الذي يحتوي على ملفات الواجهة الخلفية الخاصة بك داخل المستودع).
    *   **Runtime (وقت التشغيل):** `Python 3`.
    *   **Build Command (أمر البناء):** `pip install -r requirements.txt`
    *   **Start Command (أمر التشغيل):** `gunicorn src.main:app` (تأكد من أن `gunicorn` موجود في ملف `requirements.txt` الخاص بك).
    *   **Health Check Path (مسار فحص الصحة):** `/api/health` (اختياري، ولكن يوصى به).
5.  **المتغيرات البيئية (Environment Variables):**
    *   يمكنك إضافة متغيرات بيئية هنا إذا كنت تستخدمها (مثل `DATABASE_URL` إذا كنت تستخدم قاعدة بيانات خارجية).
6.  **إنشاء الخدمة:** انقر على `Create Web Service`.

سيبدأ Render في بناء ونشر خدمتك. يمكنك مراقبة السجلات لمعرفة التقدم المحرز وأي أخطاء.

## 3. تحديث مسارات API في الواجهة الأمامية (بعد النشر)

بمجرد نشر الواجهة الخلفية بنجاح، ستحصل على عنوان URL عام لها (مثال: `https://livreure-backend.onrender.com`).

1.  **احصل على عنوان URL للواجهة الخلفية:** من لوحة تحكم Render، انتقل إلى خدمة الويب الخاصة بالواجهة الخلفية وانسخ عنوان URL الخاص بها.
2.  **عدّل ملفات الواجهة الأمامية محليًا:**
    *   افتح ملف `script.js` في مجلد `livreure-enhanced`.
    *   ابحث عن السطر الذي يحدد `API_BASE_URL` وقم بتحديثه ليتضمن عنوان URL الجديد للواجهة الخلفية، متبوعًا بـ `/api`:
        ```javascript
        const API_BASE_URL = 'https://your-backend-service.onrender.com/api';
        ```
    *   كرر نفس الخطوة لملف `admin-dashboard/admin-script.js`.
3.  **رفع التغييرات إلى GitHub:** بعد تحديث مسارات API، قم برفع هذه التغييرات إلى مستودع GitHub الخاص بك.

بما أن الواجهة الخلفية تخدم الآن ملفات الواجهة الأمامية، فإن أي تحديثات للواجهة الأمامية ستحتاج إلى رفعها إلى نفس المستودع، وسيقوم Render بإعادة بناء ونشر خدمة الويب الخاصة بك تلقائيًا.

## 4. اختبار المنصة على Render

بعد اكتمال النشر، يمكنك زيارة عنوان URL الخاص بخدمة الويب الخاصة بالواجهة الخلفية (الذي يخدم الآن الواجهة الأمامية أيضًا) في متصفحك. يجب أن ترى الواجهة الأمامية تعمل بشكل صحيح، ويجب أن تكون جميع وظائف API متصلة بالواجهة الخلفية.

## 5. حسابات الاختبار

يمكنك استخدام حسابات الاختبار التالية:

*   **عميل:** `ahmed@customer.mr` / `customer123`
*   **مطعم:** `sahara@restaurant.mr` / `restaurant123`
*   **وكيل توصيل:** `abdullah@delivery.mr` / `delivery123`
*   **إدارة:** `admin@livreure.mr` / `admin123`

## 6. ملاحظات إضافية

*   **قاعدة البيانات:** إذا كنت تستخدم قاعدة بيانات خارجية (مثل PostgreSQL أو MySQL)، فتأكد من تكوين `DATABASE_URL` كمتغير بيئي في Render.
*   **تحديثات الواجهة الأمامية:** بما أن الواجهة الخلفية تخدم الواجهة الأمامية، فإن أي تغييرات في الواجهة الأمامية تتطلب رفع التغييرات إلى GitHub، مما سيؤدي إلى إعادة بناء خدمة الويب.
*   **Render Free Tier:** قد تكون هناك قيود على الطبقة المجانية من Render، مثل وقت السكون بعد فترة من عدم النشاط. قد تحتاج إلى الترقية لخطة مدفوعة لتطبيق جاهز للإنتاج.

---

